# PicMe - 進捗管理（タスク）

**プロジェクト名**: PicMe（ぴくみー）
**現在のバージョン**: v5.3.3
**作成日**: 2026-01-20
**最終更新**: 2026-02-10

> **バージョン表記について**: 本プロジェクトはセマンティックバージョニングに従います。
> - v0.x: 環境構築フェーズ
> - v1.x: MVP機能フェーズ（基本機能完成）
> - v2.x: 追加機能フェーズ（カスタマイズ機能）
> - v3.x: 有料機能フェーズ（サブスクリプション）
> - v4.x: 管理者機能・追加実装フェーズ
> - v5.x: テスト・デプロイフェーズ

---

## 📊 全体進捗

| リリース版 | フェーズ | ステータス | 進捗率 | 開始日 | 完了日 |
|---------|---------|----------|-------|--------|--------|
| v0.1 | 環境構築 | ✅ 完了 | 100% | 2026-01-20 | 2026-01-20 |
| v1.0 | MVP機能 | ✅ 完了 | 100% | 2026-01-21 | 2026-01-22 |
| v2.0 | 追加機能 | ✅ 完了 | 100% | 2026-01-22 | 2026-01-28 |
| v3.0 | 有料機能（バックエンド） | ✅ 完了 | 100% | 2026-02-02 | 2026-02-02 |
| v3.1 | 有料機能（フロントエンド） | ✅ 完了 | 100% | 2026-02-02 | 2026-02-02 |
| v4.0 | 管理者機能（計画） | ✅ 完了 | 100% | 2026-02-03 | 2026-02-03 |
| v4.0.1 | 管理者機能（バグ修正） | ✅ 完了 | 100% | 2026-02-03 | 2026-02-03 |
| v4.1 | 管理者機能（実装） | ✅ 完了 | 100% | 2026-02-03 | 2026-02-03 |
| v4.2 | Cloudinary画像UP + 管理者作成 | ✅ 完了 | 100% | 2026-02-07 | 2026-02-07 |
| v4.3 | SendGridメール + メール認証 + パスワードリセット | ✅ 完了 | 100% | 2026-02-07 | 2026-02-07 |
| v4.4 | Pro機能（問い合わせ・解析・カスタムCSS） | ✅ 完了 | 100% | 2026-02-07 | 2026-02-07 |
| v4.5 | UX改善（D&D並び替え + Markdownエディタ） | ✅ 完了 | 100% | 2026-02-07 | 2026-02-07 |
| v4.6 | ドキュメント整備 + バグ修正 + 環境構築ガイド | ✅ 完了 | 100% | 2026-02-07 | 2026-02-07 |
| v5.0 | テスト実装 | ✅ 完了 | 100% | 2026-02-07 | 2026-02-07 |
| v5.1 | バグ修正＋セキュリティ対策 | ✅ 完了 | 100% | 2026-02-07 | 2026-02-07 |
| v5.2 | 本番デプロイ | 🔧 進行中 | 90% | 2026-02-07 | - |
| v5.2.1 | Stripe Webhook修正 + ログ改善 | ✅ 完了 | 100% | 2026-02-09 | 2026-02-09 |
| v5.2.2 | 公開ページテーマ反映修正 | ✅ 完了 | 100% | 2026-02-09 | 2026-02-09 |
| v5.3 | ランディングページ（LP）実装 | ✅ 完了 | 100% | 2026-02-10 | 2026-02-10 |
| v5.3.1 | LP アニメーション強化（Framer Motion） | ✅ 完了 | 100% | 2026-02-10 | 2026-02-10 |
| v5.3.2 | SEO対応（robots.txt + sitemap.xml） | ✅ 完了 | 100% | 2026-02-10 | 2026-02-10 |
| v5.3.3 | 全ページデザイン統一（LP品質） | ✅ 完了 | 100% | 2026-02-10 | 2026-02-10 |
| v5.3.10 | 動的サイトマップ実装 | ✅ 完了 | 100% | 2026-02-17 | 2026-02-17 |

**全体進捗**: 完了フェーズ 22/23（96%）— v5.3.10 動的サイトマップ実装完了、残作業あり（APIキーローテーション、CI/CD再push）

---

## ✅ 完了済みバージョン

### v0.1〜v4.1: 完了済み

詳細は [変更履歴.md](./変更履歴.md) を参照。

---

## ✅ v4.2: Cloudinary画像アップロード + 管理者作成（完了）

**目標**: Cloudinary画像アップロードと管理者アカウント作成機能
**完了日**: 2026-02-07

**進捗**: 8/8タスク（100%）

### 4.2.1 Cloudinary連携
- [x] CloudinaryConfig（@Value設定 + Bean定義）
- [x] CloudinaryService（interface + impl、アップロード/削除/最適化/サムネイル）
- [x] POST /api/artworks/upload（作品画像アップロード + ストレージ制限チェック）
- [x] POST /api/profile/avatar, POST /api/profile/header（プロフィール画像）
- [x] FileUploadコンポーネント（D&D + プレビュー + プログレスバー）
- [x] artworksページ・profileページをFileUpload対応に改修

### 4.2.2 管理者アカウント作成API
- [x] POST /api/admin/users/create（AdminCreateUserRequest DTO）
- [x] Artwork.fileSizeフィールド追加 + sumFileSizeByUserIdクエリ

---

## ✅ v4.3: SendGridメールインフラ + メール認証 + パスワードリセット（完了）

**目標**: メール基盤構築、メール認証、パスワードリセット機能
**完了日**: 2026-02-07

**進捗**: 14/14タスク（100%）

### 4.3.1 メール基盤（SendGrid）
- [x] pom.xmlに依存関係追加（spring-boot-starter-mail, sendgrid-java）
- [x] SendGridConfig.java（api-key, from-email, from-name）
- [x] EmailService interface + EmailServiceImpl
- [x] 未設定時コンソールフォールバック

### 4.3.2 メール認証
- [x] VerificationTokenエンティティ + Repository
- [x] AuthServiceImpl.signup()にメール送信追加
- [x] GET /api/auth/verify?token=xxx
- [x] POST /api/auth/resend-verification
- [x] フロントエンド: verify-emailページ
- [x] フロントエンド: メール認証バナー（ダッシュボード上部）

### 4.3.3 パスワードリセット
- [x] PasswordResetTokenエンティティ + Repository
- [x] POST /api/auth/forgot-password
- [x] POST /api/auth/reset-password
- [x] フロントエンド: forgot-password / reset-passwordページ

---

## ✅ v4.4: Pro機能（問い合わせフォーム・アクセス解析・カスタムCSS）（完了）

**目標**: PRO/STUDIO向けの付加価値機能
**完了日**: 2026-02-07

**進捗**: 18/18タスク（100%）

### 4.4.1 問い合わせフォーム（PRO以上）
- [x] POST /api/users/{username}/inquiries（問い合わせ受付）
- [x] PublicInquiryRequest DTO
- [x] PublicControllerに問い合わせ保存 + EmailServiceでメール通知
- [x] フロントエンド: contact-form.tsx
- [x] 公開ページにコンタクトフォーム追加

### 4.4.2 アクセス解析（PRO以上）
- [x] PageViewエンティティ + PageViewRepository
- [x] AnalyticsService（@Async記録 + 集計）
- [x] GET /api/analytics/summary, /api/analytics/timeline
- [x] PublicController修正（ページビュー記録@Async）
- [x] フロントエンド: analyticsページ（CSSバーチャート）
- [x] サイドバーに「アクセス解析」リンク追加

### 4.4.3 カスタムCSS（PRO以上）
- [x] Profile.customCss + contactFormEnabledフィールド追加
- [x] CssSanitizer（@import, url(), expression()等をブロック）
- [x] PUT /api/profile/custom-css
- [x] フロントエンド: custom-cssページ（エディタ + ライブプレビュー）
- [x] 公開ページにカスタムCSS適用
- [x] 行数制限: PRO 100行, STUDIO 500行
- [x] PublicPageResponse修正（contactFormEnabled, customCss追加）

---

## ✅ v4.5: UX改善（D&D並び替え + Markdownエディタ）（完了）

**目標**: ドラッグ&ドロップ並び替えとMarkdownエディタ
**完了日**: 2026-02-07

**進捗**: 7/7タスク（100%）

### 4.5.1 ドラッグ&ドロップ並び替え
- [x] @dnd-kit/core, @dnd-kit/sortable, @dnd-kit/utilities 導入
- [x] SortableArtworkList コンポーネント（rectSortingStrategy）
- [x] artworksページに並び替えモード切替ボタン追加
- [x] SortableSocialLinkList + social-linksページにD&D追加

### 4.5.2 Markdownエディタ（PRO以上）
- [x] @uiw/react-md-editor 導入
- [x] Post.contentFormat追加（PLAIN/MARKDOWN）+ PostServiceImplでプランチェック
- [x] postsページにMarkdownエディタ実装（PRO以上でMarkdown ON/OFF切替）

---

## ✅ v4.6: ドキュメント整備 + バグ修正 + 環境構築ガイド（完了）

**目標**: 設計書のv4.2〜v4.5対応、AuthContextバグ修正、環境構築ガイド作成
**完了日**: 2026-02-07

**進捗**: 6/6タスク（100%）

### 4.6.1 バグ修正
- [x] AuthContext planTypeハードコード修正（ProfileResponseにplanType追加）

### 4.6.2 環境構築ガイド
- [x] backend/.env.example 作成
- [x] frontend/.env.example 作成
- [x] docs/環境構築ガイド.md 作成（Cloudinary, SendGrid, Stripe, AdSense手順）

### 4.6.3 設計書更新
- [x] 基本設計書 v2.0 更新（システム構成、DB、API、プラン制限）
- [x] 詳細設計書 v2.0 更新（画面一覧、遷移図、バリデーション）

---

## 🧪 v5.0: テスト実装

**目標**: ユニットテスト・統合テスト・E2Eテストの実装

**進捗**: 0/12タスク（0%）

### 5.0.1 バックエンドテスト（優先度: 高）

#### ユニットテスト
- [ ] AuthService テスト
- [ ] ProfileService テスト
- [ ] ArtworkService テスト
- [ ] SubscriptionService テスト
- [ ] AdminService テスト

#### 統合テスト
- [ ] AuthController テスト
- [ ] ArtworkController テスト
- [ ] SubscriptionController テスト
- [ ] AdminController テスト

### 5.0.2 フロントエンドテスト（優先度: 中）

#### E2Eテスト（Playwright）
- [ ] ユーザー登録〜ログインフロー
- [ ] 画像アップロード〜公開フロー
- [ ] プラン変更フロー

---

## ✅ v5.1: バグ修正＋セキュリティ対策（完了）

**目標**: v5.0テストで検出された12件のFAIL修正 + セキュリティ対策
**完了日**: 2026-02-07

**進捗**: 12/12タスク（100%）

### v5.1.0 バグ修正
- [x] ProfileUpdateRequestにcontactFormEnabledフィールド追加
- [x] ProfileServiceImplでcontactFormEnabled保存処理追加
- [x] ProfileServiceImplでテーマ名バリデーション追加（LIGHT/DARK/WARM/COOL）
- [x] AnalyticsServiceImplにPRO/STUDIOプランチェック追加
- [x] SubscriptionServiceImplにStripe未設定時デフォルトFREEレスポンス返却

### v5.1.1 セキュリティ修正
- [x] カスタムAuthenticationEntryPointで未認証→401+JSON応答
- [x] CORSプリフライトリクエスト（OPTIONS）許可

### v5.1.2 フロントエンド修正
- [x] SubscriptionContextのエラー時デフォルトFREEプランフォールバック

### v5.1.3 回帰テスト追加修正
- [x] SubscriptionControllerの@AuthenticationPrincipal Jwt→UserDetails統一
- [x] 回帰テスト12件全PASS確認

---

## 🔧 v5.2: 本番デプロイ（進行中）

**目標**: 本番環境へのデプロイとCI/CD構築

**進捗**: 11/14タスク（80%）— デプロイ完了、残作業あり

### 5.2.1 セキュリティ修正 ✅
- [x] docker-compose.ymlから秘密情報除去（.env参照に変更）
- [x] ルート.envファイル作成（gitignore済み）
- [ ] APIキーローテーション（Cloudinary/SendGrid/Stripe）⚠️ ユーザー作業

### 5.2.2 バックエンド本番対応 ✅
- [x] Dockerfileマルチステージビルド化（JDKビルド→JRE実行、Debianベース）
- [x] application.yml PORT変数名変更（Railway互換）
- [x] ログレベル環境変数化（LOG_LEVEL）
- [x] railway.json Config-as-code作成

### 5.2.3 フロントエンド本番対応 ✅
- [x] api.ts baseURL SSR/ブラウザ分岐対応
- [x] next.config.js rewrites改善
- [x] subscription.ts プラン価格更新

### 5.2.4 Railwayデプロイ ✅
- [x] Railwayプロジェクト作成 + Dockerfileビルダー設定
- [x] PostgreSQLプロビジョニング + プライベートネットワーク接続
- [x] 環境変数設定（JWT_SECRET, Cloudinary, SendGrid等）
- [ ] Stripe本番商品作成 + Webhook設定 ⚠️ ユーザー作業（テストモードで動作確認後）

### 5.2.5 Vercelデプロイ ✅
- [x] Vercelプロジェクト作成 + NEXT_PUBLIC_API_URL設定
- [x] カスタムドメイン pic-me.net 設定（Xserver Domain + Vercel DNS）
- [x] ユーザー登録動作確認済み

### 5.2.6 CI/CD構築 ⏳
- [x] GitHub Actions ワークフロー作成（backend-test + frontend-build）
- [ ] ci.ymlのGitHub push（workflowスコープのトークンが必要）⚠️ ユーザー作業

---

## 📝 タスク管理ルール

### ステータス定義

- **未着手**: まだ開始していない
- **進行中**: 現在作業中
- **レビュー待ち**: 実装完了、レビュー待ち
- **完了**: レビュー完了、マージ済み

### 優先度定義

- **高**: MVP・コア機能、必須
- **中**: 重要だが後回し可能
- **低**: Nice to have

### 見積もり（複雑度）

- **S（Small）**: 1〜2時間
- **M（Medium）**: 半日〜1日
- **L（Large）**: 2〜3日
- **XL（Extra Large）**: 1週間以上

---

## 📊 マイルストーン

| マイルストーン | 期限目標 | 説明 |
|-------------|---------|------|
| 🏁 M1: v0.1リリース | 2026-01-20 | ✅ 環境構築完了 |
| 🏁 M2: v1.0リリース | 2026-01-22 | ✅ MVP機能完了 |
| 🏁 M3: v2.0リリース | 2026-01-28 | ✅ 追加機能完了 |
| 🏁 M4: v3.1リリース | 2026-02-02 | ✅ 有料機能完了 |
| 🏁 M5: v4.1リリース | 2026-02-03 | ✅ 管理者機能完了 |
| 🏁 M5.5: v4.2リリース | 2026-02-07 | ✅ Cloudinary + 管理者作成 |
| 🏁 M6: v4.5リリース | 2026-02-07 | ✅ 追加実装完了 |
| 🏁 M6.5: v4.6リリース | 2026-02-07 | ✅ ドキュメント整備完了 |
| 🏁 M7: v5.2リリース | TBD | ⏳ 正式リリース |

---

## 🐛 バグ・課題トラッカー

### 既知の課題

| ID | 内容 | 優先度 | ステータス |
|----|------|--------|----------|
| BUG-001 | contactFormEnabledが保存されない | 高 | ✅ v5.1.0で修正 |
| BUG-002 | アクセス解析APIにプラン制限なし | 高 | ✅ v5.1.0で修正 |
| BUG-003 | Stripe未設定時にstatus 500 | 高 | ✅ v5.1.0で修正 |
| BUG-004 | テーマ名バリデーションなし | 中 | ✅ v5.1.0で修正 |
| BUG-005 | 未認証時401→403 | 高 | ✅ v5.1.1で修正 |
| BUG-006 | CORS OPTIONS 403 | 高 | ✅ v5.1.1で修正 |
| BUG-007 | 管理者画面Subscription 500影響 | 中 | ✅ v5.1.2で修正 |

### 技術的負債

| ID | 内容 | 対応予定 |
|----|------|---------|
| TD-1 | ~~画像アップロードがURL入力のみ~~ | ✅ v4.2で解消 |
| TD-2 | ~~管理者アカウントが手動作成のみ~~ | ✅ v4.2で解消 |
| TD-3 | ~~作品並び替えがD&D非対応~~ | ✅ v4.5で解消 |
| TD-4 | ~~お知らせ編集がプレーンテキストのみ~~ | ✅ v4.5で解消 |
| TD-5 | ~~メール認証なし~~ | ✅ v4.3で解消 |
| TD-6 | ~~パスワードリセット機能なし~~ | ✅ v4.3で解消 |

---

## 📌 メモ・備考

- v4.2〜v4.5は追加機能であり、本番リリースには必須ではない
- v5.0〜v5.2は本番リリース前に必須
- Stripe・AdSenseの本番設定はv5.2で実施（Stripe Webhook Secretはローカルでは未設定、本番デプロイ時に要設定）
- セキュリティ監査はv5.1で実施、問題があればv5.1.xで修正

---

## 🔗 関連ドキュメント

- [要件定義書](./要件定義書.md)
- [基本設計書](./基本設計書.md)
- [詳細設計書](./詳細設計書.md)
- [変更履歴](./変更履歴.md)

---

**最終更新**: 2026-02-08
**次回更新予定**: v5.2残作業完了時（Stripe Webhook、APIキーローテーション）
