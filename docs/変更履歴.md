# PicMe - 変更履歴

すべての重要な変更をこのファイルに記載しています。

## バージョン表記方法

このプロジェクトはセマンティックバージョニング（[SemVer](http://semver.org/)）に従います。

- **メジャー版**: 大きな機能追加またはフェーズ完了（v1.0, v2.0, v3.0...）
- **マイナー版**: 新機能追加（v1.1, v1.2...）
- **パッチ版**: バグ修正（v1.0.1, v1.0.2...）

---

## [開発中 / Unreleased]

### 計画中の機能

- v3.0: プラン制限UI実装（フロントエンド）
- v3.0: Google AdSense広告表示
- v4.0: 管理者認証・管理画面
- v5.0: 総合テスト・セキュリティ監査
- v5.0: 本番環境デプロイ（Vercel/Railway）

---

## [v3.0] - 2026-02-02

### 追加（Added）

- **Stripe連携バックエンド実装**
  - Subscription エンティティ・リポジトリ作成
  - SubscriptionService 実装（Stripe SDK統合）
  - SubscriptionController 実装
  - Stripe Webhook処理実装
    - `checkout.session.completed` - 決済完了処理
    - `customer.subscription.updated` - サブスクリプション更新処理
    - `customer.subscription.deleted` - サブスクリプション削除処理
    - `invoice.payment_succeeded` - 支払い成功処理
    - `invoice.payment_failed` - 支払い失敗処理

- **サブスクリプションAPIエンドポイント**
  - `GET /api/subscriptions/status` - サブスクリプション状態取得
  - `POST /api/subscriptions/checkout` - Checkoutセッション作成
  - `POST /api/subscriptions/cancel` - サブスクリプションキャンセル
  - `POST /api/subscriptions/resume` - サブスクリプション再開
  - `POST /api/subscriptions/webhook` - Stripe Webhook受信

- **プラン別制限情報API**
  - PlanLimits レスポンスDTO
  - プラン別制限値の定義（maxArtworks, maxSocialLinks, maxPosts, maxCategories, maxStorageMb, hasAds）

### 変更（Changed）

- SecurityConfig: Webhook エンドポイントを公開エンドポイントに追加
- pom.xml: Stripe Java SDK 24.15.0 追加
- application.yml: Stripe設定セクション追加

- **フロントエンドサブスクリプションUI**
  - プラン・課金画面（/upgrade）実装
  - プラン比較カード表示
  - Stripe Checkoutへのリダイレクト
  - サブスクリプション状態表示
  - キャンセル・再開機能
  - サイドバーにプラン・課金リンク追加

- **プラン制限機能**
  - カテゴリー数制限チェック追加（PRO: 5, STUDIO: 無制限）
  - STUDIOプランのSNSリンク制限を無制限に修正
  - SubscriptionContext（サブスクリプション状態管理）
  - UpgradePromptコンポーネント（制限通知・アップグレード誘導）

- **Google AdSense対応**
  - AdBannerコンポーネント（基本広告バナー）
  - FreeUserAdコンポーネント（Freeプラン専用広告表示）
  - 環境変数によるAdSense設定（クライアントID・広告スロットID）
  - 公開ページへの広告配置（ヘッダー下/ギャラリー上/フッター上）

- **管理画面へのプラン制限表示統合**
  - 作品管理: 作品数制限表示・上限時ボタン無効化
  - SNSリンク管理: リンク数制限表示・上限時ボタン無効化
  - 投稿管理: 投稿数制限表示・上限時ボタン無効化
  - カテゴリー管理: カテゴリー数制限表示・上限時ボタン無効化

### 注意（Notes）

- Stripe APIキー・Webhook Secretは環境変数で設定が必要
- AdSense環境変数: NEXT_PUBLIC_ADSENSE_CLIENT_ID, NEXT_PUBLIC_ADSENSE_SLOT_*
- AdSenseはデプロイ・審査後に環境変数を設定することで有効化

---

## [v2.1.5] - 2026-01-30

### 追加（Added）

- **詳細設計書にバリデーションルール一覧セクションを追加**
  - 用語定義（ユーザーID / ユーザー名 / 表示名）
  - 全フィールドの文字数制限を明記
  - プラン別制限を明記

- **テスト仕様書（xlsx形式）を追加**
  - `docs/test/PicMe_テスト仕様書_v2.1.xlsx`
  - 具体的なテスト値を記載
  - 設計書との整合性を確認済み

### 変更（Changed）

- **バリデーション制限の変更（設計書・実装両方）**
  - 表示名（displayName）: 100文字 → **32文字**
  - カテゴリー名: 100文字 → **50文字**
  - タグ名: 50文字 → **30文字**

- **プラン別投稿制限の変更**
  - FREE: 5件 → **1件**
  - STARTER: 20件 → **5件**
  - PRO: 20件（変更なし）
  - STUDIO: 無制限（変更なし）

---

## [v2.1.4] - 2026-01-30

### 追加（Added）

- **公開プロフィールページのデザイン強化**

  - **アバターのビューポート対応**
    - `min()` 関数を使用したレスポンシブサイズ
    - SP: `min(45vw, 220px)` / PC: `min(30vw, 280px)` / 大画面: `min(25vw, 320px)`
    - ホバー時のシャドウ拡大アニメーション追加
    - グラデーション背景のフォールバック表示

  - **SNSアイコンの大型カラフルデザイン**
    - プラットフォーム別背景色（Twitter=黒、Instagram=グラデーション、Facebook=青、YouTube=赤、Pixiv=水色）
    - 角丸正方形ボタン（`rounded-2xl` / `rounded-3xl`）
    - ホバー時の回転・拡大エフェクト
    - プラットフォーム名のホバー表示

### 変更（Changed）

- SNSリンクのUIをボタン形式からカラフルアイコンブロックに変更
- アバターの境界線を `border-slate-100` から `border-white` に変更

---

## [v2.1.3] - 2026-01-28

### 追加（Added）

- **デザイン拡張（v2.1 Phase 5）の実装**

  - **余白・レイアウト改善**
    - ヘッダーエリア高さを `min-h-[45vh]` に拡大
    - セクション間余白を `mt-32` → `mt-40 md:mt-48` に拡大
    - カード・グリッドの余白を `p-4` → `p-6` に拡大
    - 角丸を `rounded-xl` → `rounded-2xl` / `rounded-3xl` に拡大

  - **アイコン・アバターサイズ拡大**
    - メインアバター: `160px` → `180px (SP) / 240px (PC)`
    - SNSアイコン: `32px` → `40px (SP) / 48px (PC)`
    - スキルバードット: `h-3 w-3` → `h-4 w-4` + グロー効果
    - セクションタイトル: `text-4xl` → `text-6xl md:text-7xl`

  - **作品グリッドの改善**
    - カラム数変更: `3カラム` → `2カラム (PC) / 1カラム (SP)`
    - 作品カードホバー: `scale-105` + 強化されたシャドウ効果
    - 作品カード下にタイトル・日付表示を追加
    - MasonryGridにレスポンシブ対応（`mobileColumns` prop追加）

  - **コンポーネント更新**
    - `masonry-grid.tsx`: レスポンシブカラム対応
    - `skill-bar.tsx`: サイズ拡大、グロー効果追加
    - `section-title.tsx`: サイズ拡大、カラー調整
    - `bento-grid.tsx`: 余白・角丸・ホバー効果改善

### 変更（Changed）

- 公開プロフィールページ全体のデザインリファイン
- BentoGridItemのフォントサイズ・余白調整

---

## [v2.1.2] - 2026-01-28

### 変更（Changed）

- **デザイン設計書の更新**
  - アバターサイズ、アイコンサイズの大型化。
  - 作品表示の変更案反映。
  - `docs/画面設計書.md` を v2.1.2 に更新。
  - `docs/画面設計進捗管理.md` のデザイン拡張フェーズを "v3.0" から "v2.1" に変更（マイナーバージョンとしての実装へ変更）。

---

## [v2.1.1] - 2026-01-28

### 修正（Fixed）

- **Hydration Mismatch 警告の抑制**
  - ブラウザ拡張機能（WOT等）によって注入される属性（`wotdisconnected`等）に起因するサーバー・クライアント間のHTML不一致警告を抑制するため、`layout.tsx` の `body` タグに `suppressHydrationWarning` を追加。

---

## [v2.1] - 2026-01-28

### 修正（Fixed）

- **Next.js 15 非同期 Params 対応**
  - `generateMetadata` および Client Component での `params` Promise アンラップ処理の実装。
  - インポート文の欠落による Runtime Error (`Loader2 is not defined`) の修正。

- **Docker コンテナ間通信（Networking）の改善**
  - Next.js サーバーサイドからバックエンドへのリクエストが `localhost` で失敗する問題を修正。
  - `INTERNAL_API_URL` 環境変数を導入し、`docker-compose` ネットワーク経由で `http://backend:8080` を参照するように変更。

---

## [v2.0] - 2026-01-28

### 追加（Added）

- **お知らせ・ブログ機能**
  - Post エンティティ・API実装
  - フロントエンドUI（B05画面）
  - マークダウン表示対応（Pro以上で編集機能予定）

- **テーマ・カスタマイズ機能**
  - 複数テーマプリセット実装
  - カラーピッカーUI実装（Pro以上）
  - フォント選択機能実装（Pro以上）
  - テーマプレビュー機能
  - テーマ適用・保存ロジック

- **カテゴリー・タグ機能**
  - Category・Tag エンティティ作成
  - カテゴリー・タグ管理API実装
  - フロントエンド管理画面（B05）
  - 作品フィルタリング機能
  - 公開ページでのカテゴリー・タグフィルター表示
  - タグクラウド表示

- **テスト仕様書**
  - Phase 1-3 総合テスト仕様書作成（271テストケース）
  - テスト成績記入用フォーマット設計

- **バージョン管理**
  - Phaseからバージョン表記（v0.1-v5.0）への統一
  - セマンティックバージョニング導入

### 変更（Changed）

- 進捗管理をPhase表記からVersion表記へ統一
- 画面設計進捗管理ドキュメントの表記統一
- セマンティックバージョニング採用

### 修正（Fixed）

- カテゴリー・タグの削除時の使用中チェック

### 削除（Removed）

- _なし_

### セキュリティ（Security）

- XSS対策（カテゴリー・タグ・投稿テキストのエスケープ）
- CSRF保護確認（各POSTエンドポイント）

---

## [v1.0] - 2026-01-22

### 追加（Added）

- **認証機能**
  - ユーザー登録・ログイン機能
  - JWT トークンベース認証
  - パスワードのハッシュ化（BCrypt）
  - トークンリフレッシュ機能
  - ログアウト機能

- **プロフィール機能**
  - ユーザープロフィール表示・編集
  - 表示名・自己紹介・アイコン管理
  - プロフィール画像アップロード（URL入力）

- **作品ギャラリー機能**
  - 作品CRUD操作
  - 作品画像アップロード
  - 作品並び替え機能
  - プラン別作品数制限（FREE: 5, STARTER: 20, PRO: 50, STUDIO: 200）

- **SNSリンク機能**
  - SNSリンク追加・編集・削除
  - 複数プラットフォーム対応（Twitter/X, Instagram, Pixiv など）
  - リンク表示順序管理

- **公開ページ機能**
  - ポートフォリオサイト公開機能（/@username形式）
  - OGPメタデータ自動生成
  - 画像遅延読み込み（Lazy Loading）
  - レスポンシブデザイン対応

- **ダッシュボード**
  - ユーザーダッシュボード UI
  - 統計情報表示（作品数など）
  - クイックアクション

- **開発環境**
  - Docker Compose セットアップ
  - PostgreSQL ローカル環境
  - Spring Boot 3.x バックエンド基盤
  - Next.js 15 フロントエンド基盤
  - TailwindCSS デザインシステム

### セキュリティ（Security）

- SQLインジェクション対策
- XSS対策（テキスト入力フィルタリング）
- CSRF保護（Spring Security設定）
- JWT検証とセッション管理

---

## [v0.1] - 2026-01-20

### 追加（Added）

- **プロジェクト初期化**
  - GitHub リポジトリ初期化
  - .gitignore ファイル設定
  - README.md 作成

- **フロントエンド環境**
  - Next.js 15 プロジェクト作成
  - TypeScript 設定
  - TailwindCSS 統合
  - アプリケーションフォルダ構成（app, components, lib）

- **バックエンド環境**
  - Spring Boot 3.x プロジェクト初期化
  - Maven ビルド設定
  - application.yml 基本設定
  - パッケージ構成（controller, service, repository）

- **データベース**
  - PostgreSQL 15 Docker イメージ設定
  - Docker Compose オーケストレーション
  - ローカル開発環境構築

- **ドキュメント**
  - 要件定義書作成
  - 基本設計書作成
  - 詳細設計書作成
  - 画面設計書作成
  - 進捗管理ドキュメント作成

---

## 変更ログ記入ガイドライン

新しいバージョンをリリースする際は、以下のセクションを追加してください：

```markdown
## [vX.Y.Z] - YYYY-MM-DD

### 追加（Added）
- 新機能の説明

### 変更（Changed）
- 既存機能の変更内容

### 修正（Fixed）
- バグ修正の説明

### 削除（Removed）
- 削除された機能

### セキュリティ（Security）
- セキュリティ関連の改善
```

### セクション説明

- **Added**: 新しい機能追加
- **Changed**: 既存機能の変更（後方互換性あり）
- **Deprecated**: 廃止予定機能
- **Removed**: 削除された機能
- **Fixed**: バグ修正
- **Security**: セキュリティ脆弱性修正

---

## リリーススケジュール（予定）

| バージョン | フェーズ | 目標期限 | ステータス |
|----------|---------|--------|----------|
| v0.1 | 環境構築 | 2026-01-20 | ✅ 完了 |
| v1.0 | MVP機能 | 2026-01-22 | ✅ 完了 |
| v2.0 | 追加機能 | 2026-01-28 | ✅ 完了 |
| v3.0 | 有料機能 | TBD | 🔄 進行中 |
| v4.0 | 管理者機能 | TBD | ⏳ 未着手 |
| v5.0 | テスト・デプロイ | TBD | ⏳ 未着手 |

---

## 更新情報

- **作成日**: 2026-01-28
- **最終更新**: 2026-02-02
- **管理者**: PicMe Development Team

---

*このファイルはセマンティックバージョニングの原則に従って更新されます。*
